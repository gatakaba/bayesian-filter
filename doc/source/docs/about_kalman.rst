カルマンフィルタとは?
================================

カルマンフィルタとは、観測されたデータに基づき、線形確率システムの状態を逐次的に推定するアルゴリズムです。
時系列データならばどのようなデータに対して適用することができ、航空工学、ロボット工学、画像処理、計量経済学、農学など
多岐にわたる分野において適用例があります。

何ができるの?
===============

カルマンフィルタが適用される場面は主にノイズ除去・未来予測・外れ値推定・センサヒュージョンです。
カルマンフィルタは線形・雑音がガウスノイズという性質を持ち、そのため一般の状態空間モデルと比較して少ない計算量
であるという性質を持ちます。

LQGの仮定
--------------
1. システム方程式及び観測方程式の線形性 (Linear)
2. システムの雑音及び観測雑音の白色性 (white)
3. 雑音分布のガウス正規性 (Gaussian)
4. ２乗誤差規範
カルマンフィルタはLQG仮定の元、事後推定誤差分散を最小化することを目的としている

確率システム
------------------
システム方程式

:math:`p(z_{n}|z_{n-1})=N(z_{n}|Az_{n-1},\Gamma)`


:math:`p(x_{n}|z_{n})=N(x_{n}|Cz_{n},\Sigma)`

定式化
------

観測更新ステップ

:math:`p(z_{t}|X^{t})=\frac{p(x_{t}|z_{t})p(z_{t}|X^{t-1})}{p(x_{t}|X^{t-1})}`

時間更新ステップ

:math:`p(z_{t+1}|X^{t})=\int p(z_{t+1}|z_{t})p(z_{t}|X^{t}) dz_{t}`

用語と記号
----------

事前推定誤差: :math:`\hat{e} = \mu_{k} - \bar{\mu}_{k} = \mu_{k} - E[z|x_{k-1}]`

事後推定誤差: :math:`\hat{e} = \mu_{k} - \hat{\mu}_{k} = \mu_{k} - E[z|x_{k}]`

事前推定誤差分散: :math:`P_{k} = E[\hat{e}_{k} \hat{e}_{k}^{T}]`

事後推定誤差分散: :math:`P_{k} = E[e_{k} e_{k}^{T}]`

計算
------

予測
^^^^^^^^^^^^^^

* 事前平均値

  :math:`\mu_{n}^{-} = A \mu_{n-1}`

* 事前分散

  :math:`P_{n-1}=A V_{n-1} A^{T} + \Gamma`

フィルタリング
^^^^^^^^^^^^^^^^^^^

* カルマンゲイン

  :math:`K_{n}=P_{n-1}C^{T}(CP_{n-1}C^{T}+\Sigma)^{-1}`

* 事後平均値

  :math:`\mu_{n}=\mu_{n}^{-} +K_{n}(x_{n}-C \mu_{n}^{-})`

* 事後分散

  :math:`V_{n}=(I-K_{n}C)P_{n-1}`


メモ
-----

* システムが定常であるとき、カルマンゲインは収束する

    :math:`\mu_{n}=A\mu_{n-1}+K_{n}(x_{n}-CA\mu_{n-1})= A\mu_{n-1}+\frac{P_{n-1}}{P_{n-1}+\frac{\Sigma}{C^2}}\frac{(x_{n}-\hat{x}_{n})}{C}`

* :math:`\Sigma << P_{n-1}` の時、すなわち、システム方程式の分散が、観測値の分散よりも大きい場合、カルマンゲインは大きくなり、観測に基づく推定結果が支配的になる。



参考
-------
* 非線形カルマンフィルタ
* PRML 下巻
